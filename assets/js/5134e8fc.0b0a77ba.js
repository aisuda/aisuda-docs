"use strict";(self.webpackChunkaisuda_docs=self.webpackChunkaisuda_docs||[]).push([[4203],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>k});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=p(t),m=r,k=d["".concat(s,".").concat(m)]||d[m]||c[m]||l;return t?a.createElement(k,o(o({ref:n},u),{},{components:t})):a.createElement(k,o({ref:n},u))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,o=new Array(l);o[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[d]="string"==typeof e?e:r,o[1]=i;for(var p=2;p<l;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},33003:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var a=t(87462),r=(t(67294),t(3905));const l={id:"\u57fa\u7840"},o=void 0,i={unversionedId:"API\u5bf9\u63a5/\u57fa\u7840",id:"API\u5bf9\u63a5/\u57fa\u7840",title:"\u57fa\u7840",description:"\u666e\u901a\u9875\u9762\u652f\u6301 API \u7684\u65b9\u5f0f\u5bf9\u63a5\u5916\u90e8\u63a5\u53e3\uff0c\u5b9e\u73b0\u7075\u6d3b\u6269\u5c55\uff0cAPI \u8be6\u60c5\u8bf7\u53c2\u8003 amis \u6587\u6863\u3002",source:"@site/docs/API\u5bf9\u63a5/\u57fa\u7840.md",sourceDirName:"API\u5bf9\u63a5",slug:"/API\u5bf9\u63a5/\u57fa\u7840",permalink:"/aisuda-docs/API\u5bf9\u63a5/\u57fa\u7840",draft:!1,editUrl:"https://github.com/aisuda/aisuda-docs/edit/main/docs/API\u5bf9\u63a5/\u57fa\u7840.md",tags:[],version:"current",frontMatter:{id:"\u57fa\u7840"},sidebar:"usernamual",previous:{title:"\u5c06\u9875\u9762\u5d4c\u5165\u5916\u90e8\u7cfb\u7edf",permalink:"/aisuda-docs/\u9875\u9762\u8bbe\u8ba1/\u5c06\u9875\u9762\u5d4c\u5165\u5916\u90e8\u7cfb\u7edf"},next:{title:"\u7cfb\u7edfAPI",permalink:"/aisuda-docs/API\u5bf9\u63a5/\u7cfb\u7edfAPI"}},s={},p=[{value:"API \u4ee3\u7406",id:"api-\u4ee3\u7406",level:2},{value:"\u5982\u679c\u4e0d\u60f3\u7ecf\u8fc7\u5185\u7f6e\u4ee3\u7406",id:"\u5982\u679c\u4e0d\u60f3\u7ecf\u8fc7\u5185\u7f6e\u4ee3\u7406",level:2},{value:"\u5728\u5404\u79cd\u8bed\u8a00\u4e0b\u83b7\u53d6\u53c2\u6570\u7684\u65b9\u6cd5",id:"\u5728\u5404\u79cd\u8bed\u8a00\u4e0b\u83b7\u53d6\u53c2\u6570\u7684\u65b9\u6cd5",level:2},{value:"Node",id:"node",level:3},{value:"Java",id:"java",level:3},{value:"PHP",id:"php",level:3},{value:".NET",id:"net",level:3},{value:"go",id:"go",level:3},{value:"Python",id:"python",level:3},{value:"Ruby",id:"ruby",level:3}],u={toc:p},d="wrapper";function c(e){let{components:n,...t}=e;return(0,r.kt)(d,(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u666e\u901a\u9875\u9762\u652f\u6301 API \u7684\u65b9\u5f0f\u5bf9\u63a5\u5916\u90e8\u63a5\u53e3\uff0c\u5b9e\u73b0\u7075\u6d3b\u6269\u5c55\uff0cAPI \u8be6\u60c5\u8bf7\u53c2\u8003 ",(0,r.kt)("a",{parentName:"p",href:"https://baidu.gitee.io/amis/zh-CN/docs/types/api"},"amis \u6587\u6863"),"\u3002"),(0,r.kt)("p",null,"\u5728\u7231\u901f\u642d\u4e2d\u6709\u4e24\u4e2a\u7279\u6b8a\u529f\u80fd\uff1a"),(0,r.kt)("h2",{id:"api-\u4ee3\u7406"},"API \u4ee3\u7406"),(0,r.kt)("p",null,"\u666e\u901a\u9875\u9762\u4e2d\u7684 api \u5728\u6700\u7ec8\u6e32\u67d3\u65f6\u4f1a\u8fdb\u884c url \u66ff\u6362\uff0c\u6bd4\u5982\u5728\u9875\u9762\u8bbe\u8ba1\u4e2d\u7684\u914d\u7f6e\u4e2d\u53ef\u80fd\u8fd9\u6837\u5199\u7684\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "api": "https://3xsw4ap8wah59.cfc-execute.bj.baidubce.com/api/amis-mock/sample"\n}\n')),(0,r.kt)("p",null,"\u5728\u5b9e\u9645\u8fd0\u884c\u4e2d\uff0c\u7231\u901f\u642d\u4f1a\u5c06\u8fd9\u4e2a\u5730\u5740\u8fdb\u884c\u8f6c\u6362\uff0c\u5b9e\u9645\u5728\u9875\u9762\u4e2d\u4f1a\u662f\u7c7b\u4f3c\u4e0b\u9762\u7684\u5730\u5740"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "api": "/api/proxy/34fbe7"\n}\n')),(0,r.kt)("p",null,"\u8fd9\u6837\u505a\u6709\u4ee5\u4e0b\u51e0\u4e2a\u597d\u5904\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u89e3\u51b3\u524d\u7aef\u8de8\u57df\u95ee\u9898\uff0c\u56e0\u4e3a\u7b2c\u4e09\u65b9 api \u80af\u5b9a\u4e0d\u5728\u7231\u901f\u642d\u57df\u540d\u4e0b"),(0,r.kt)("li",{parentName:"ol"},"\u907f\u514d\u63a5\u53e3\u5730\u5740\u66b4\u9732"),(0,r.kt)("li",{parentName:"ol"},"\u4f20\u9012\u4e00\u4e9b\u7231\u901f\u642d\u7279\u6709\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u5f53\u524d\u7528\u6237\u540d\u3001\u73af\u5883\u3001\u5e94\u7528 key \u7b49")),(0,r.kt)("p",null,"\u524d\u9762\u8bf4\u5230\u7684\u7279\u6709\u4fe1\u606f\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u8fd9\u4e9b header \u83b7\u53d6\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-token"),"\uff0c\u5728\u300c\u5e94\u7528\u8bbe\u7f6e\u300d\u4e2d\u7684 token"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-appkey"),"\uff0c\u5e94\u7528\u77ed\u8def\u5f84"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-env"),"\uff0c\u5e94\u7528\u73af\u5883\uff0c\u5f00\u53d1\u73af\u5883\u662f ",(0,r.kt)("inlineCode",{parentName:"li"},"dev"),"\uff0c\u4e5f\u53ef\u80fd\u662f ",(0,r.kt)("inlineCode",{parentName:"li"},"qa"),"\u3001",(0,r.kt)("inlineCode",{parentName:"li"},"sandbox"),"\u6216\u8005",(0,r.kt)("inlineCode",{parentName:"li"},"latest")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-userid"),"\uff0c\u7528\u6237\u5728\u7231\u901f\u642d\u4e2d\u7684 id"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-username"),"\uff0c\u7528\u6237\u540d"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-oauth-id"),"\uff0coauth id\uff0c\u5982\u679c\u542f\u7528\u4e86 oauth \u767b\u5f55\u7684\u8bdd"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-oauth-access-token"),"\uff0coauth \u7684 access token \u5982\u679c\u542f\u7528\u4e86 oauth \u767b\u5f55\u7684\u8bdd"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-roles"),"\uff0c\u7528\u6237\u6240\u5c5e\u7684\u89d2\u8272\u540d\u5217\u8868"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-profile-access-token")," \u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684 access token\uff0c\u5177\u4f53\u8bf7\u770b\u4e0b\u65b9\u8bf4\u660e")),(0,r.kt)("p",null,"\u5982\u679c\u4e0d\u653e\u5fc3\u76f4\u63a5\u6839\u636e header \u4e0b\u53d1\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"x-isuda-username")," \u5b8c\u6210\u7528\u6237\u8ba4\u8bc1\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u5173\u6389\u8fd9\u4e2a\u529f\u80fd"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"ISUDA_DISABLE_PROXY_USER_ID: true\n")),(0,r.kt)("p",null,"\u8fd9\u6837\u5c31\u53ea\u4f1a\u4e0b\u53d1\u4ee5\u4e0b header \u4e86\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-token")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-appkey")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-env")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-profile-access-token")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-oauth-id"),"\uff0coauth id\uff0c\u5982\u679c\u5f00\u542f\u4e86 oauth \u767b\u5f55\u8ba4\u8bc1\u7684\u8bdd"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"x-isuda-oauth-access-token"),"\uff0coauth \u7684 access token\uff0c\u5982\u679c\u5f00\u542f\u4e86 oauth \u767b\u5f55\u8ba4\u8bc1\u7684\u8bdd")),(0,r.kt)("p",null,"\u7136\u540e\u901a\u8fc7\u8bf7\u6c42 ",(0,r.kt)("inlineCode",{parentName:"p"},"/openapi/profile?token={{\u8fd9\u91cc\u7528 x-isuda-profile-access-token \u8fd4\u56de\u7684 token \u503c}}"),"\n\u5c31\u4f1a\u83b7\u53d6\u4ee5\u4e0b\u4fe1\u606f\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "username": "xxxx",\n  "roles": ["xxxx", "xxx"],\n  "userid": "xxxx",\n  "email": "xxx@xx.com"\n}\n')),(0,r.kt)("h2",{id:"\u5982\u679c\u4e0d\u60f3\u7ecf\u8fc7\u5185\u7f6e\u4ee3\u7406"},"\u5982\u679c\u4e0d\u60f3\u7ecf\u8fc7\u5185\u7f6e\u4ee3\u7406"),(0,r.kt)("p",null,"\u53ef\u4ee5\u5728 url \u524d\u52a0\u4e0a ",(0,r.kt)("inlineCode",{parentName:"p"},"raw:"),"\uff0c\u5c31\u4e0d\u4f1a\u8d70\u4ee3\u7406\u3002"),(0,r.kt)("p",null,"\u9700\u8981\u89e3\u51b3\u8de8\u57df\u95ee\u9898\uff0c\u6bd4\u5982\u8fd4\u56de\u8de8\u57df header\uff1a\u793a\u4f8b\u5982\u4e0b"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Access-Control-Allow-Origin: https://suda.bce.baidu.com"),"\uff0c\u6216\u8005\u7231\u901f\u642d\u90e8\u7f72\u7684\u57df\u540d"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Access-Control-Allow-Credentials: true")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Access-Control-Allow-Methods: POST, GET, OPTIONS"))),(0,r.kt)("p",null,"\u793a\u4f8b\u4ee3\u7801\uff08express\uff09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u653e\u5728\u6240\u6709\u8def\u7531\u524d\u9762\napp.use(function (req, res, next) {\n  res.header('Access-Control-Allow-Origin', 'https://suda.bce.baidu.com');\n  res.header('Access-Control-Allow-Credentials', 'true');\n  res.header(\n    'Access-Control-Allow-Headers',\n    'Origin, X-Requested-With, Content-Type, Accept'\n  );\n  res.header('Access-Control-Allow-Methods', 'POST, GET, OPTIONS');\n  next();\n});\n")),(0,r.kt)("p",null,"\u5982\u679c\u63a5\u53e3\u9700\u8981\u767b\u5f55\uff0c\u53ef\u4ee5\u5728\u672a\u767b\u5f55\u7684\u65f6\u5019\u8fd4\u56de 401\uff0c\u5185\u5bb9\u662f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "location": "http://\u8df3\u8f6c\u767b\u5f55\u7684\u9875\u9762\u5730\u5740"\n}\n')),(0,r.kt)("p",null,"\u9700\u8981\u6ce8\u610f\u5728\u65b0\u6d4f\u89c8\u5668\u4e0b\u9ed8\u8ba4\u4f1a\u9650\u5236 cookie \u8de8\u57df\uff0c\u6240\u4ee5\u767b\u5f55\u540e\u4fdd\u5b58\u72b6\u6001\u7684 cookie \u5fc5\u987b\u52a0\u4e0a ",(0,r.kt)("inlineCode",{parentName:"p"},"SameSite=None; Secure"),"\uff0c\u7c7b\u4f3c\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Set-Cookie: session=123; SameSite=None; Secure\n")),(0,r.kt)("p",null,"\u5982\u679c\u60f3\u672c\u5730\u5f00\u53d1\u63a5\u53e3\u8bf7\u67e5\u770b",(0,r.kt)("a",{parentName:"p",href:"/aisuda-docs/API%E5%AF%B9%E6%8E%A5/%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95"},"\u8fd9\u91cc"),"\u3002"),(0,r.kt)("h2",{id:"\u5728\u5404\u79cd\u8bed\u8a00\u4e0b\u83b7\u53d6\u53c2\u6570\u7684\u65b9\u6cd5"},"\u5728\u5404\u79cd\u8bed\u8a00\u4e0b\u83b7\u53d6\u53c2\u6570\u7684\u65b9\u6cd5"),(0,r.kt)("h3",{id:"node"},"Node"),(0,r.kt)("p",null,"\u4ee5 Express \u4e3a\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const express = require('express');\nconst app = express();\nconst bodyParser = require('body-parser');\napp.use(bodyParser.json());\napp.post('/api', function(req, res) {\n    console.log(req.body);  // \u53c2\u6570 json\n    res.json(...);\n})\napp.listen(3000)\n")),(0,r.kt)("h3",{id:"java"},"Java"),(0,r.kt)("p",null,"\u4ee5 Spring \u4e3a\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@RequestMapping(value = "/api", method = POST, consumes = MediaType.ALL_VALUE, produces = MediaType.APPLICATION_JSON_UTF8_VALUE)\n@ResponseBody\npublic String api(@RequestBody String body) {\n    // body \u5c31\u662f\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684 json\uff0c\u9700\u8981\u4f7f\u7528 Jackson \u7b49\u5e93\u89e3\u6790\u4e3a\u5bf9\u8c61\u6765\u4f7f\u7528\n}\n\n')),(0,r.kt)("h3",{id:"php"},"PHP"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"<?PHP\n$json = file_get_contents('php://input');\n$data = json_decode($json);\n")),(0,r.kt)("h3",{id:"net"},".NET"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'using Microsoft.AspNetCore.Mvc;\nusing System.IO;\nusing Newtonsoft.Json;\n\nnamespace MvcMovie.Controllers\n{\n    public class HelloWorldController : Controller\n    {\n        [HttpPost]\n        public JsonResult Index()\n        {\n\n            using (var reader = new StreamReader(HttpContext.Request.Body))\n            {\n                dynamic json = JsonConvert.DeserializeObject(reader.ReadToEnd());\n                var conditions = json.conditions;\n                var data = new { status = 0, msg = "" };\n                return Json(data);\n            }\n        }\n    }\n}\n')),(0,r.kt)("h3",{id:"go"},"go"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"func api(w http.ResponseWriter, r *http.Request) {\n    body, _ := ioutil.ReadAll(r.Body)\n    var result map[string]interface{}  // \u8fd9\u91cc\u7b80\u5316\u4e86\uff0c\u6700\u597d\u53c2\u8003\u5bf9\u5e94\u7684\u53c2\u6570\u8bf4\u660e\u6587\u6863\u521b\u5efa struct\n    json.Unmarshal(body, &result)\n}\n")),(0,r.kt)("h3",{id:"python"},"Python"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"import json\n# falcon \u6846\u67b6\nclass SugarAPI(object):\n    def on_post(self, req, resp):\n        data = json.load(req.bounded_stream)\n\n# flask \u6846\u67b6\nfrom flask import request\n@app.route('/api', methods=['POST'])\ndef sugar_api():\n    data = json.loads(request.data)\n\n")),(0,r.kt)("h3",{id:"ruby"},"Ruby"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},"require 'sinatra'\nrequire 'json'\n\npost '/api/' do\n  request.body.rewind\n  request_payload = JSON.parse request.body.read\nend\n")))}c.isMDXComponent=!0}}]);